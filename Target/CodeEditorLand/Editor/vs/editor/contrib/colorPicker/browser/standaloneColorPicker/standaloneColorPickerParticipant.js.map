{
  "version": 3,
  "sources": ["../../../../../../../../../Dependency/Land/Dependency/Editor/Source/vs/editor/contrib/colorPicker/browser/standaloneColorPicker/standaloneColorPickerParticipant.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from '../../../../../base/common/cancellation.js';\nimport { Color } from '../../../../../base/common/color.js';\nimport { DisposableStore, IDisposable } from '../../../../../base/common/lifecycle.js';\nimport { IThemeService } from '../../../../../platform/theme/common/themeService.js';\nimport { ICodeEditor } from '../../../../browser/editorBrowser.js';\nimport { LanguageFeatureRegistry } from '../../../../common/languageFeatureRegistry.js';\nimport { DocumentColorProvider, IColorInformation } from '../../../../common/languages.js';\nimport { IEditorHoverRenderContext } from '../../../hover/browser/hoverTypes.js';\nimport { getColors } from '../color.js';\nimport { ColorDetector } from '../colorDetector.js';\nimport { ColorPickerModel } from '../colorPickerModel.js';\nimport { BaseColor, createColorHover, updateColorPresentations, updateEditorModel } from '../colorPickerParticipantUtils.js';\nimport { ColorPickerWidget } from '../hoverColorPicker/hoverColorPickerWidget.js';\nimport { Range } from '../../../../common/core/range.js';\nimport { EditorOption } from '../../../../common/config/editorOptions.js';\nimport { Dimension } from '../../../../../base/browser/dom.js';\n\nexport class StandaloneColorPickerHover implements BaseColor {\n\tconstructor(\n\t\tpublic readonly owner: StandaloneColorPickerParticipant,\n\t\tpublic readonly range: Range,\n\t\tpublic readonly model: ColorPickerModel,\n\t\tpublic readonly provider: DocumentColorProvider\n\t) { }\n\n\tpublic static fromBaseColor(owner: StandaloneColorPickerParticipant, color: BaseColor) {\n\t\treturn new StandaloneColorPickerHover(owner, color.range, color.model, color.provider);\n\t}\n}\n\nexport class StandaloneColorPickerParticipant {\n\n\tpublic readonly hoverOrdinal: number = 2;\n\tprivate _color: Color | null = null;\n\n\tconstructor(\n\t\tprivate readonly _editor: ICodeEditor,\n\t\t@IThemeService private readonly _themeService: IThemeService,\n\t) { }\n\n\tpublic async createColorHover(defaultColorInfo: IColorInformation, defaultColorProvider: DocumentColorProvider, colorProviderRegistry: LanguageFeatureRegistry<DocumentColorProvider>): Promise<{ colorHover: StandaloneColorPickerHover; foundInEditor: boolean } | null> {\n\t\tif (!this._editor.hasModel()) {\n\t\t\treturn null;\n\t\t}\n\t\tconst colorDetector = ColorDetector.get(this._editor);\n\t\tif (!colorDetector) {\n\t\t\treturn null;\n\t\t}\n\t\tconst colors = await getColors(colorProviderRegistry, this._editor.getModel(), CancellationToken.None);\n\t\tlet foundColorInfo: IColorInformation | null = null;\n\t\tlet foundColorProvider: DocumentColorProvider | null = null;\n\t\tfor (const colorData of colors) {\n\t\t\tconst colorInfo = colorData.colorInfo;\n\t\t\tif (Range.containsRange(colorInfo.range, defaultColorInfo.range)) {\n\t\t\t\tfoundColorInfo = colorInfo;\n\t\t\t\tfoundColorProvider = colorData.provider;\n\t\t\t}\n\t\t}\n\t\tconst colorInfo = foundColorInfo ?? defaultColorInfo;\n\t\tconst colorProvider = foundColorProvider ?? defaultColorProvider;\n\t\tconst foundInEditor = !!foundColorInfo;\n\t\tconst colorHover = StandaloneColorPickerHover.fromBaseColor(this, await createColorHover(this._editor.getModel(), colorInfo, colorProvider));\n\t\treturn { colorHover, foundInEditor };\n\t}\n\n\tpublic async updateEditorModel(colorHoverData: StandaloneColorPickerHover): Promise<void> {\n\t\tif (!this._editor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\t\tconst colorPickerModel = colorHoverData.model;\n\t\tlet range = new Range(colorHoverData.range.startLineNumber, colorHoverData.range.startColumn, colorHoverData.range.endLineNumber, colorHoverData.range.endColumn);\n\t\tif (this._color) {\n\t\t\tawait updateColorPresentations(this._editor.getModel(), colorPickerModel, this._color, range, colorHoverData);\n\t\t\trange = updateEditorModel(this._editor, range, colorPickerModel);\n\t\t}\n\t}\n\n\tpublic renderHoverParts(context: IEditorHoverRenderContext, hoverParts: StandaloneColorPickerHover[]): { disposables: IDisposable; hoverPart: StandaloneColorPickerHover; colorPicker: ColorPickerWidget } | undefined {\n\t\tif (hoverParts.length === 0 || !this._editor.hasModel()) {\n\t\t\treturn undefined;\n\t\t}\n\t\tif (context.setMinimumDimensions) {\n\t\t\tconst minimumHeight = this._editor.getOption(EditorOption.lineHeight) + 8;\n\t\t\tcontext.setMinimumDimensions(new Dimension(302, minimumHeight));\n\t\t}\n\n\t\tconst disposables = new DisposableStore();\n\t\tconst colorHover = hoverParts[0];\n\t\tconst editorModel = this._editor.getModel();\n\t\tconst model = colorHover.model;\n\t\tconst colorPicker = disposables.add(new ColorPickerWidget(context.fragment, model, this._editor.getOption(EditorOption.pixelRatio), this._themeService, true));\n\n\t\tlet editorUpdatedByColorPicker = false;\n\t\tconst range = new Range(colorHover.range.startLineNumber, colorHover.range.startColumn, colorHover.range.endLineNumber, colorHover.range.endColumn);\n\t\tconst color = colorHover.model.color;\n\t\tthis._color = color;\n\t\tupdateColorPresentations(editorModel, model, color, range, colorHover);\n\t\tdisposables.add(model.onColorFlushed((color: Color) => {\n\t\t\tthis._color = color;\n\t\t}));\n\t\tdisposables.add(model.onDidChangeColor((color: Color) => {\n\t\t\tupdateColorPresentations(editorModel, model, color, range, colorHover);\n\t\t}));\n\t\tdisposables.add(this._editor.onDidChangeModelContent((e) => {\n\t\t\tif (editorUpdatedByColorPicker) {\n\t\t\t\teditorUpdatedByColorPicker = false;\n\t\t\t} else {\n\t\t\t\tcontext.hide();\n\t\t\t\tthis._editor.focus();\n\t\t\t}\n\t\t}));\n\t\treturn { hoverPart: colorHover, colorPicker, disposables };\n\t}\n}\n"],
  "mappings": "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",
  "names": ["colorInfo", "color"]
}
