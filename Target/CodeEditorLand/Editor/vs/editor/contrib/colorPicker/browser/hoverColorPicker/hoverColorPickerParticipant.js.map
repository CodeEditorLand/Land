{
  "version": 3,
  "sources": ["../../../../../../../../../Dependency/Land/Dependency/Editor/Source/vs/editor/contrib/colorPicker/browser/hoverColorPicker/hoverColorPickerParticipant.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { AsyncIterableObject } from '../../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../../base/common/cancellation.js';\nimport { ICodeEditor } from '../../../../browser/editorBrowser.js';\nimport { Range } from '../../../../common/core/range.js';\nimport { IModelDecoration } from '../../../../common/model.js';\nimport { DocumentColorProvider } from '../../../../common/languages.js';\nimport { ColorDetector } from '../colorDetector.js';\nimport { ColorPickerModel } from '../colorPickerModel.js';\nimport { ColorPickerWidget } from './hoverColorPickerWidget.js';\nimport { HoverAnchor, HoverAnchorType, IEditorHoverParticipant, IEditorHoverRenderContext, IHoverPart, IRenderedHoverPart, IRenderedHoverParts, RenderedHoverParts } from '../../../hover/browser/hoverTypes.js';\nimport { IThemeService } from '../../../../../platform/theme/common/themeService.js';\nimport * as nls from '../../../../../nls.js';\nimport { BaseColor, createColorHover, updateColorPresentations, updateEditorModel } from '../colorPickerParticipantUtils.js';\nimport { EditorOption } from '../../../../common/config/editorOptions.js';\nimport { Dimension } from '../../../../../base/browser/dom.js';\nimport { DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { Color } from '../../../../../base/common/color.js';\n\nexport class ColorHover implements IHoverPart, BaseColor {\n\n\t/**\n\t * Force the hover to always be rendered at this specific range,\n\t * even in the case of multiple hover parts.\n\t */\n\tpublic readonly forceShowAtRange: boolean = true;\n\n\tconstructor(\n\t\tpublic readonly owner: IEditorHoverParticipant<ColorHover>,\n\t\tpublic readonly range: Range,\n\t\tpublic readonly model: ColorPickerModel,\n\t\tpublic readonly provider: DocumentColorProvider\n\t) { }\n\n\tpublic isValidForHoverAnchor(anchor: HoverAnchor): boolean {\n\t\treturn (\n\t\t\tanchor.type === HoverAnchorType.Range\n\t\t\t&& this.range.startColumn <= anchor.range.startColumn\n\t\t\t&& this.range.endColumn >= anchor.range.endColumn\n\t\t);\n\t}\n\n\tpublic static fromBaseColor(owner: IEditorHoverParticipant<ColorHover>, color: BaseColor): ColorHover {\n\t\treturn new ColorHover(owner, color.range, color.model, color.provider);\n\t}\n}\n\nexport class HoverColorPickerParticipant implements IEditorHoverParticipant<ColorHover> {\n\n\tpublic readonly hoverOrdinal: number = 2;\n\n\tprivate _colorPicker: ColorPickerWidget | undefined;\n\n\tconstructor(\n\t\tprivate readonly _editor: ICodeEditor,\n\t\t@IThemeService private readonly _themeService: IThemeService,\n\t) { }\n\n\tpublic computeSync(_anchor: HoverAnchor, _lineDecorations: IModelDecoration[]): ColorHover[] {\n\t\treturn [];\n\t}\n\n\tpublic computeAsync(anchor: HoverAnchor, lineDecorations: IModelDecoration[], token: CancellationToken): AsyncIterableObject<ColorHover> {\n\t\treturn AsyncIterableObject.fromPromise(this._computeAsync(anchor, lineDecorations, token));\n\t}\n\n\tprivate async _computeAsync(_anchor: HoverAnchor, lineDecorations: IModelDecoration[], _token: CancellationToken): Promise<ColorHover[]> {\n\t\tif (!this._editor.hasModel()) {\n\t\t\treturn [];\n\t\t}\n\t\tconst colorDetector = ColorDetector.get(this._editor);\n\t\tif (!colorDetector) {\n\t\t\treturn [];\n\t\t}\n\t\tfor (const d of lineDecorations) {\n\t\t\tif (!colorDetector.isColorDecoration(d)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst colorData = colorDetector.getColorData(d.range.getStartPosition());\n\t\t\tif (colorData) {\n\t\t\t\tconst colorHover = ColorHover.fromBaseColor(this, await createColorHover(this._editor.getModel(), colorData.colorInfo, colorData.provider));\n\t\t\t\treturn [colorHover];\n\t\t\t}\n\n\t\t}\n\t\treturn [];\n\t}\n\n\tpublic renderHoverParts(context: IEditorHoverRenderContext, hoverParts: ColorHover[]): IRenderedHoverParts<ColorHover> {\n\t\tconst editor = this._editor;\n\t\tif (hoverParts.length === 0 || !editor.hasModel()) {\n\t\t\treturn new RenderedHoverParts([]);\n\t\t}\n\t\tif (context.setMinimumDimensions) {\n\t\t\tconst minimumHeight = editor.getOption(EditorOption.lineHeight) + 8;\n\t\t\tcontext.setMinimumDimensions(new Dimension(302, minimumHeight));\n\t\t}\n\n\t\tconst disposables = new DisposableStore();\n\t\tconst colorHover = hoverParts[0];\n\t\tconst editorModel = editor.getModel();\n\t\tconst model = colorHover.model;\n\t\tthis._colorPicker = disposables.add(new ColorPickerWidget(context.fragment, model, editor.getOption(EditorOption.pixelRatio), this._themeService, false));\n\n\t\tlet editorUpdatedByColorPicker = false;\n\t\tlet range = new Range(colorHover.range.startLineNumber, colorHover.range.startColumn, colorHover.range.endLineNumber, colorHover.range.endColumn);\n\n\t\tdisposables.add(model.onColorFlushed(async (color: Color) => {\n\t\t\tawait updateColorPresentations(editorModel, model, color, range, colorHover);\n\t\t\teditorUpdatedByColorPicker = true;\n\t\t\trange = updateEditorModel(editor, range, model);\n\t\t}));\n\t\tdisposables.add(model.onDidChangeColor((color: Color) => {\n\t\t\tupdateColorPresentations(editorModel, model, color, range, colorHover);\n\t\t}));\n\t\tdisposables.add(editor.onDidChangeModelContent((e) => {\n\t\t\tif (editorUpdatedByColorPicker) {\n\t\t\t\teditorUpdatedByColorPicker = false;\n\t\t\t} else {\n\t\t\t\tcontext.hide();\n\t\t\t\teditor.focus();\n\t\t\t}\n\t\t}));\n\t\tconst renderedHoverPart: IRenderedHoverPart<ColorHover> = {\n\t\t\thoverPart: ColorHover.fromBaseColor(this, colorHover),\n\t\t\thoverElement: this._colorPicker.domNode,\n\t\t\tdispose() { disposables.dispose(); }\n\t\t};\n\t\treturn new RenderedHoverParts([renderedHoverPart]);\n\t}\n\n\tpublic getAccessibleContent(hoverPart: ColorHover): string {\n\t\treturn nls.localize('hoverAccessibilityColorParticipant', 'There is a color picker here.');\n\t}\n\n\tpublic handleResize(): void {\n\t\tthis._colorPicker?.layout();\n\t}\n\n\tpublic isColorPickerVisible(): boolean {\n\t\treturn !!this._colorPicker;\n\t}\n}\n"],
  "mappings": ";;;;;;;;;;;;AAKA,SAAS,2BAA2B;AACpC,SAAS,yBAAyB;AAClC,SAAS,mBAAmB;AAC5B,SAAS,aAAa;AACtB,SAAS,wBAAwB;AACjC,SAAS,6BAA6B;AACtC,SAAS,qBAAqB;AAC9B,SAAS,wBAAwB;AACjC,SAAS,yBAAyB;AAClC,SAAS,aAAa,iBAAiB,yBAAyB,2BAA2B,YAAY,oBAAoB,qBAAqB,0BAA0B;AAC1K,SAAS,qBAAqB;AAC9B,YAAY,SAAS;AACrB,SAAS,WAAW,kBAAkB,0BAA0B,yBAAyB;AACzF,SAAS,oBAAoB;AAC7B,SAAS,iBAAiB;AAC1B,SAAS,uBAAuB;AAChC,SAAS,aAAa;AAEf,MAAM,WAA4C;AAAA,EAQxD,YACiB,OACA,OACA,OACA,UACf;AAJe;AACA;AACA;AACA;AAAA,EACb;AAAA,EApCL,OAuByD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMxC,mBAA4B;AAAA,EASrC,sBAAsB,QAA8B;AAC1D,WACC,OAAO,SAAS,gBAAgB,SAC7B,KAAK,MAAM,eAAe,OAAO,MAAM,eACvC,KAAK,MAAM,aAAa,OAAO,MAAM;AAAA,EAE1C;AAAA,EAEA,OAAc,cAAc,OAA4C,OAA8B;AACrG,WAAO,IAAI,WAAW,OAAO,MAAM,OAAO,MAAM,OAAO,MAAM,QAAQ;AAAA,EACtE;AACD;AAEO,IAAM,8BAAN,MAAiF;AAAA,EAMvF,YACkB,SACe,eAC/B;AAFgB;AACe;AAAA,EAC7B;AAAA,EA5DL,OAmDwF;AAAA;AAAA;AAAA,EAEvE,eAAuB;AAAA,EAE/B;AAAA,EAOD,YAAY,SAAsB,kBAAoD;AAC5F,WAAO,CAAC;AAAA,EACT;AAAA,EAEO,aAAa,QAAqB,iBAAqC,OAA2D;AACxI,WAAO,oBAAoB,YAAY,KAAK,cAAc,QAAQ,iBAAiB,KAAK,CAAC;AAAA,EAC1F;AAAA,EAEA,MAAc,cAAc,SAAsB,iBAAqC,QAAkD;AACxI,QAAI,CAAC,KAAK,QAAQ,SAAS,GAAG;AAC7B,aAAO,CAAC;AAAA,IACT;AACA,UAAM,gBAAgB,cAAc,IAAI,KAAK,OAAO;AACpD,QAAI,CAAC,eAAe;AACnB,aAAO,CAAC;AAAA,IACT;AACA,eAAW,KAAK,iBAAiB;AAChC,UAAI,CAAC,cAAc,kBAAkB,CAAC,GAAG;AACxC;AAAA,MACD;AAEA,YAAM,YAAY,cAAc,aAAa,EAAE,MAAM,iBAAiB,CAAC;AACvE,UAAI,WAAW;AACd,cAAM,aAAa,WAAW,cAAc,MAAM,MAAM,iBAAiB,KAAK,QAAQ,SAAS,GAAG,UAAU,WAAW,UAAU,QAAQ,CAAC;AAC1I,eAAO,CAAC,UAAU;AAAA,MACnB;AAAA,IAED;AACA,WAAO,CAAC;AAAA,EACT;AAAA,EAEO,iBAAiB,SAAoC,YAA2D;AACtH,UAAM,SAAS,KAAK;AACpB,QAAI,WAAW,WAAW,KAAK,CAAC,OAAO,SAAS,GAAG;AAClD,aAAO,IAAI,mBAAmB,CAAC,CAAC;AAAA,IACjC;AACA,QAAI,QAAQ,sBAAsB;AACjC,YAAM,gBAAgB,OAAO,UAAU,aAAa,UAAU,IAAI;AAClE,cAAQ,qBAAqB,IAAI,UAAU,KAAK,aAAa,CAAC;AAAA,IAC/D;AAEA,UAAM,cAAc,IAAI,gBAAgB;AACxC,UAAM,aAAa,WAAW,CAAC;AAC/B,UAAM,cAAc,OAAO,SAAS;AACpC,UAAM,QAAQ,WAAW;AACzB,SAAK,eAAe,YAAY,IAAI,IAAI,kBAAkB,QAAQ,UAAU,OAAO,OAAO,UAAU,aAAa,UAAU,GAAG,KAAK,eAAe,KAAK,CAAC;AAExJ,QAAI,6BAA6B;AACjC,QAAI,QAAQ,IAAI,MAAM,WAAW,MAAM,iBAAiB,WAAW,MAAM,aAAa,WAAW,MAAM,eAAe,WAAW,MAAM,SAAS;AAEhJ,gBAAY,IAAI,MAAM,eAAe,OAAO,UAAiB;AAC5D,YAAM,yBAAyB,aAAa,OAAO,OAAO,OAAO,UAAU;AAC3E,mCAA6B;AAC7B,cAAQ,kBAAkB,QAAQ,OAAO,KAAK;AAAA,IAC/C,CAAC,CAAC;AACF,gBAAY,IAAI,MAAM,iBAAiB,CAAC,UAAiB;AACxD,+BAAyB,aAAa,OAAO,OAAO,OAAO,UAAU;AAAA,IACtE,CAAC,CAAC;AACF,gBAAY,IAAI,OAAO,wBAAwB,CAAC,MAAM;AACrD,UAAI,4BAA4B;AAC/B,qCAA6B;AAAA,MAC9B,OAAO;AACN,gBAAQ,KAAK;AACb,eAAO,MAAM;AAAA,MACd;AAAA,IACD,CAAC,CAAC;AACF,UAAM,oBAAoD;AAAA,MACzD,WAAW,WAAW,cAAc,MAAM,UAAU;AAAA,MACpD,cAAc,KAAK,aAAa;AAAA,MAChC,UAAU;AAAE,oBAAY,QAAQ;AAAA,MAAG;AAAA,IACpC;AACA,WAAO,IAAI,mBAAmB,CAAC,iBAAiB,CAAC;AAAA,EAClD;AAAA,EAEO,qBAAqB,WAA+B;AAC1D,WAAO,IAAI,SAAS,sCAAsC,+BAA+B;AAAA,EAC1F;AAAA,EAEO,eAAqB;AAC3B,SAAK,cAAc,OAAO;AAAA,EAC3B;AAAA,EAEO,uBAAgC;AACtC,WAAO,CAAC,CAAC,KAAK;AAAA,EACf;AACD;AAhGa,8BAAN;AAAA,EAQJ;AAAA,GARU;",
  "names": []
}
