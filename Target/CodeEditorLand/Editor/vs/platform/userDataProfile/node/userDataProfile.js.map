{
  "version": 3,
  "sources": ["../../../../../../../Dependency/Land/Dependency/Editor/Source/vs/platform/userDataProfile/node/userDataProfile.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI, UriDto } from '../../../base/common/uri.js';\nimport { INativeEnvironmentService } from '../../environment/common/environment.js';\nimport { IFileService } from '../../files/common/files.js';\nimport { ILogService } from '../../log/common/log.js';\nimport { IStateReadService, IStateService } from '../../state/node/state.js';\nimport { IUriIdentityService } from '../../uriIdentity/common/uriIdentity.js';\nimport { IUserDataProfilesService, UserDataProfilesService as BaseUserDataProfilesService, StoredUserDataProfile, StoredProfileAssociations } from '../common/userDataProfile.js';\nimport { isString } from '../../../base/common/types.js';\nimport { SaveStrategy, StateService } from '../../state/node/stateService.js';\n\ntype StoredUserDataProfileState = StoredUserDataProfile & { location: URI | string };\n\nexport class UserDataProfilesReadonlyService extends BaseUserDataProfilesService implements IUserDataProfilesService {\n\n\tconstructor(\n\t\t@IStateReadService private readonly stateReadonlyService: IStateReadService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t\t@INativeEnvironmentService private readonly nativeEnvironmentService: INativeEnvironmentService,\n\t\t@IFileService fileService: IFileService,\n\t\t@ILogService logService: ILogService,\n\t) {\n\t\tsuper(nativeEnvironmentService, fileService, uriIdentityService, logService);\n\t}\n\n\tprotected override getStoredProfiles(): StoredUserDataProfile[] {\n\t\tconst storedProfilesState = this.stateReadonlyService.getItem<UriDto<StoredUserDataProfileState>[]>(UserDataProfilesReadonlyService.PROFILES_KEY, []);\n\t\treturn storedProfilesState.map(p => ({ ...p, location: isString(p.location) ? this.uriIdentityService.extUri.joinPath(this.profilesHome, p.location) : URI.revive(p.location) }));\n\t}\n\n\tprotected override getStoredProfileAssociations(): StoredProfileAssociations {\n\t\treturn this.stateReadonlyService.getItem<StoredProfileAssociations>(UserDataProfilesReadonlyService.PROFILE_ASSOCIATIONS_KEY, {});\n\t}\n\n\tprotected override getDefaultProfileExtensionsLocation(): URI {\n\t\treturn this.uriIdentityService.extUri.joinPath(URI.file(this.nativeEnvironmentService.extensionsPath).with({ scheme: this.profilesHome.scheme }), 'extensions.json');\n\t}\n\n}\n\nexport class UserDataProfilesService extends UserDataProfilesReadonlyService implements IUserDataProfilesService {\n\n\tconstructor(\n\t\t@IStateService protected readonly stateService: IStateService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t\t@INativeEnvironmentService environmentService: INativeEnvironmentService,\n\t\t@IFileService fileService: IFileService,\n\t\t@ILogService logService: ILogService,\n\t) {\n\t\tsuper(stateService, uriIdentityService, environmentService, fileService, logService);\n\t}\n\n\tprotected override saveStoredProfiles(storedProfiles: StoredUserDataProfile[]): void {\n\t\tif (storedProfiles.length) {\n\t\t\tthis.stateService.setItem(UserDataProfilesService.PROFILES_KEY, storedProfiles.map(profile => ({ ...profile, location: this.uriIdentityService.extUri.basename(profile.location) })));\n\t\t} else {\n\t\t\tthis.stateService.removeItem(UserDataProfilesService.PROFILES_KEY);\n\t\t}\n\t}\n\n\tprotected override saveStoredProfileAssociations(storedProfileAssociations: StoredProfileAssociations): void {\n\t\tif (storedProfileAssociations.emptyWindows || storedProfileAssociations.workspaces) {\n\t\t\tthis.stateService.setItem(UserDataProfilesService.PROFILE_ASSOCIATIONS_KEY, storedProfileAssociations);\n\t\t} else {\n\t\t\tthis.stateService.removeItem(UserDataProfilesService.PROFILE_ASSOCIATIONS_KEY);\n\t\t}\n\t}\n}\n\nexport class ServerUserDataProfilesService extends UserDataProfilesService implements IUserDataProfilesService {\n\n\tconstructor(\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t\t@INativeEnvironmentService environmentService: INativeEnvironmentService,\n\t\t@IFileService fileService: IFileService,\n\t\t@ILogService logService: ILogService,\n\t) {\n\t\tsuper(new StateService(SaveStrategy.IMMEDIATE, environmentService, logService, fileService), uriIdentityService, environmentService, fileService, logService);\n\t}\n\n\toverride async init(): Promise<void> {\n\t\tawait (this.stateService as StateService).init();\n\t\treturn super.init();\n\t}\n\n}\n"],
  "mappings": ";;;;;;;;;;;;AAKA,SAAS,KAAK,cAAc;AAC5B,SAAS,iCAAiC;AAC1C,SAAS,oBAAoB;AAC7B,SAAS,mBAAmB;AAC5B,SAAS,mBAAmB,qBAAqB;AACjD,SAAS,2BAA2B;AACpC,SAAS,0BAA0B,2BAA2B,6BAA6B,uBAAuB,iCAAiC;AACnJ,SAAS,gBAAgB;AACzB,SAAS,cAAc,oBAAoB;AAIpC,IAAM,kCAAN,cAA8C,4BAAgE;AAAA,EAEpH,YACqC,sBACf,oBACuB,0BAC9B,aACD,YACZ;AACD,UAAM,0BAA0B,aAAa,oBAAoB,UAAU;AANvC;AAEQ;AAAA,EAK7C;AAAA,EA3BD,OAiBqH;AAAA;AAAA;AAAA,EAYjG,oBAA6C;AAC/D,UAAM,sBAAsB,KAAK,qBAAqB,QAA8C,gCAAgC,cAAc,CAAC,CAAC;AACpJ,WAAO,oBAAoB,IAAI,QAAM,EAAE,GAAG,GAAG,UAAU,SAAS,EAAE,QAAQ,IAAI,KAAK,mBAAmB,OAAO,SAAS,KAAK,cAAc,EAAE,QAAQ,IAAI,IAAI,OAAO,EAAE,QAAQ,EAAE,EAAE;AAAA,EACjL;AAAA,EAEmB,+BAA0D;AAC5E,WAAO,KAAK,qBAAqB,QAAmC,gCAAgC,0BAA0B,CAAC,CAAC;AAAA,EACjI;AAAA,EAEmB,sCAA2C;AAC7D,WAAO,KAAK,mBAAmB,OAAO,SAAS,IAAI,KAAK,KAAK,yBAAyB,cAAc,EAAE,KAAK,EAAE,QAAQ,KAAK,aAAa,OAAO,CAAC,GAAG,iBAAiB;AAAA,EACpK;AAED;AAzBa,kCAAN;AAAA,EAGJ;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,GAPU;AA2BN,IAAM,0BAAN,cAAsC,gCAAoE;AAAA,EAEhH,YACmC,cACb,oBACM,oBACb,aACD,YACZ;AACD,UAAM,cAAc,oBAAoB,oBAAoB,aAAa,UAAU;AANjD;AAAA,EAOnC;AAAA,EAtDD,OA4CiH;AAAA;AAAA;AAAA,EAY7F,mBAAmB,gBAA+C;AACpF,QAAI,eAAe,QAAQ;AAC1B,WAAK,aAAa,QAAQ,wBAAwB,cAAc,eAAe,IAAI,cAAY,EAAE,GAAG,SAAS,UAAU,KAAK,mBAAmB,OAAO,SAAS,QAAQ,QAAQ,EAAE,EAAE,CAAC;AAAA,IACrL,OAAO;AACN,WAAK,aAAa,WAAW,wBAAwB,YAAY;AAAA,IAClE;AAAA,EACD;AAAA,EAEmB,8BAA8B,2BAA4D;AAC5G,QAAI,0BAA0B,gBAAgB,0BAA0B,YAAY;AACnF,WAAK,aAAa,QAAQ,wBAAwB,0BAA0B,yBAAyB;AAAA,IACtG,OAAO;AACN,WAAK,aAAa,WAAW,wBAAwB,wBAAwB;AAAA,IAC9E;AAAA,EACD;AACD;AA3Ba,0BAAN;AAAA,EAGJ;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,GAPU;AA6BN,IAAM,gCAAN,cAA4C,wBAA4D;AAAA,EAzE/G,OAyE+G;AAAA;AAAA;AAAA,EAE9G,YACsB,oBACM,oBACb,aACD,YACZ;AACD,UAAM,IAAI,aAAa,aAAa,WAAW,oBAAoB,YAAY,WAAW,GAAG,oBAAoB,oBAAoB,aAAa,UAAU;AAAA,EAC7J;AAAA,EAEA,MAAe,OAAsB;AACpC,UAAO,KAAK,aAA8B,KAAK;AAC/C,WAAO,MAAM,KAAK;AAAA,EACnB;AAED;AAhBa,gCAAN;AAAA,EAGJ;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,GANU;",
  "names": []
}
